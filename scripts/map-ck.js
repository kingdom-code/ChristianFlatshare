jQuery(document).ready(function(e){function x(t,n){var i=[],s=e(location).attr("host"),o=e(location).attr("protocol"),u=new google.maps.MarkerImage(o+"//"+s+"/images/gmap-icon.png"),a=new google.maps.MarkerImage(o+"//"+s+"/images/gmap-icon-shadow.png");for(var f=0;f<n.length;f++){var l=n[f],c=new google.maps.LatLng(l.lat,l.lng),h=new google.maps.Marker({position:c,icon:u,shadow:a,title:l.title,draggable:!1,visible:!0,html:l.html});google.maps.event.addListener(h,"click",function(){k(t,this);b.close()});r.extend(c);i.push(h)}return i}function T(t,n,r){var i=[],s=e(location).attr("host"),o=e(location).attr("protocol");if(r=="church")var r=new google.maps.MarkerImage(o+"//"+s+"/images/gmap-church-icon.png"),u=new google.maps.MarkerImage(o+"//"+s+"/images/gmap-church-icon-shadow.png");else if(r=="organisation")var r=new google.maps.MarkerImage(o+"//"+s+"/images/gmap-organisation-icon.png"),u=new google.maps.MarkerImage(o+"//"+s+"/images/gmap-organisation-icon-shadow.png");else if(r=="studentGroup")var r=new google.maps.MarkerImage(o+"//"+s+"/images/gmap-fellowship-icon.png"),u=new google.maps.MarkerImage(o+"//"+s+"/images/gmap-fellowship-icon-shadow.png");for(var a=0;a<n.length;a++){var f=n[a],l=new google.maps.LatLng(f.lat,f.lng),c=new google.maps.Marker({position:l,icon:r,shadow:u,title:f.title,draggable:!1,visible:!0,html:f.html});google.maps.event.addListener(c,"click",function(){if(S==1)return!1;b.setContent(this.html);b.open(t,this)});i.push(c)}return i}function N(e,t){e.setCenter(t.getCenter());e.fitBounds(t)}function C(e,t){var n=new google.maps.LatLngBounds;for(var r=0;r<t.length;r++){var i=t[r],s=new google.maps.LatLng(i.lat,i.lng),o=new google.maps.Marker({position:s,map:e,title:i.title,draggable:!1,animation:google.maps.Animation.DROP,visible:!0,html:i.html});google.maps.event.addListener(o,"click",function(){k(e,o)});n.extend(s)}e.setCenter(n.getCenter());e.fitBounds(n)}function k(e,t){w=e.getCenter();E=e.getZoom();S=!0;e.setOptions({disableDefaultUI:!0,draggable:!1});var n=t.getPosition(),r=new google.maps.LatLng(n.lat(),n.lng());jQuery("#resultInfo").html('<div class="inner"><a href="#" class="closeInfo">Close<span></span></a>'+t.html+"</div>");jQuery("#resultInfo").show();F();jQuery(".FBFriends img").tooltip({position:{my:"center top",at:"center bottom+5"}});jQuery(".closeInfo").click(function(){L();return!1})}function L(){S=!1;n.panTo(w);n.setZoom(E);n.setOptions({disableDefaultUI:!1,draggable:!0});jQuery("#resultInfo").hide()}function A(){m!=null&&m.setMap(null)}function O(){A();transitLayer=new google.maps.TransitLayer;transitLayer.setMap(n);m=transitLayer}function M(){A();bicyclingLayer=new google.maps.BicyclingLayer;bicyclingLayer.setMap(n);m=bicyclingLayer}function _(){f==null?f=new MarkerClusterer(n,a,u):f.addMarkers(a)}function D(){f.clearMarkers()}function P(){h==null?h=new MarkerClusterer(n,c,l):h.addMarkers(c)}function H(){h.clearMarkers()}function B(){v==null?v=new MarkerClusterer(n,d,p):v.addMarkers(d)}function j(){v.clearMarkers()}function F(){e("a.save_ad_button").click(function(){var t=e(this).attr("id"),n=t.split("_");e.ajax({url:"ajax-functions.php?action=save&post_type="+n[1]+"&id="+n[3]}).done(function(n){n.result=="insert_success"||n.result=="update_hidden"?e("#"+t).children("img").attr("src","images/button_hidden_ad.gif"):n.result=="update_unsaved"?e("#"+t).children("img").attr("src","images/button_hidesave_ad.gif"):n.result=="update_saved"?e("#"+t).children("img").attr("src","images/button_saved_ad.gif"):alert("An error occurred when updating the status of your saved ad.\n We apologise for the inconvenience.\nPlease contact problems@chirstianflatshare.org.")});return!1})}var t={center:new google.maps.LatLng(51.1063,-0.12714),zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP},n=new google.maps.Map(document.getElementById("resultsMap"),t),r=new google.maps.LatLngBounds,i={gridSize:20,maxZoom:15},s=x(n,properties),o=new MarkerClusterer(n,s,i),u={gridSize:100,maxZoom:15},a=T(n,churches,"church"),f=null,l={gridSize:100,maxZoom:15},c=T(n,organisations,"organisation"),h=null,p={gridSize:100,maxZoom:15},d=T(n,studentGroups,"studentGroup"),v=null;e(".markers input:checked").each(function(t,n){var r=e(n).attr("id");r=="showChurches"?_():r=="showOrganisations"?P():r=="showStudentGroups"&&B()});e(".markers input").change(function(){var t=e(this).attr("id"),n=e(this).is(":checked");console.log(t);console.log(n);if(t=="showChurches"){n==1?_():D();var r="show_churches"}else if(t=="showOrganisations"){n==1?P():H();var r="show_organisations"}else if(t=="showStudentGroups"){n==1?B():j();var r="show_student_groups"}var i=n?1:0;e.ajax({url:"ajaxResponses.php?target=saveDefault&key="+r+"&value="+i})});var m=null,g=e(".overlays input:checked");if(g.length>0){var y=g.val();y=="transit"?O():y=="bicycling"&&M()}e(".overlays input").change(function(){var t=e(".overlays input:checked");if(t.length>0){var n=t.val();n=="transit"?O():n=="bicycling"?M():A();e.ajax({url:"ajaxResponses.php?target=saveDefault&key=overlay&value="+n})}});N(n,r);var b=new google.maps.InfoWindow,w=null,E=null,S=!1});